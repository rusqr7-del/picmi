<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
            max-width: 500px;
            width: 100%;
            margin: 50px auto;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            color: #667eea;
            margin-bottom: 30px;
            text-align: center;
            font-size: 2em;
        }

        h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-success {
            background: #27ae60;
        }

        .btn-danger {
            background: #e74c3c;
        }

        .btn-small {
            width: auto;
            padding: 8px 16px;
            font-size: 14px;
        }

        .error {
            color: #e74c3c;
            background: #ffe0e0;
            padding: 10px;
            border-radius: 8px;
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
        }

        .success {
            color: #27ae60;
            background: #e0ffe0;
            padding: 10px;
            border-radius: 8px;
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
        }

        .hidden {
            display: none !important;
        }

        .user-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            transition: transform 0.2s;
        }

        .user-card:hover {
            transform: scale(1.02);
            background: #e9ecef;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 24px;
        }

        .user-details {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            color: #333;
            font-size: 18px;
        }

        .rating-display {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            font-size: 14px;
        }

        .rating-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .pikmi-count {
            color: #27ae60;
            font-weight: bold;
        }

        .eball-count {
            color: #e74c3c;
            font-weight: bold;
        }

        .total-rating {
            color: #667eea;
            font-weight: bold;
            font-size: 24px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .file-input-wrapper {
            position: relative;
            margin-top: 10px;
        }

        .file-input-wrapper input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-label {
            display: block;
            padding: 12px;
            background: #f8f9fa;
            border: 2px dashed #667eea;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: background 0.3s;
        }

        .file-label:hover {
            background: #e9ecef;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #999;
        }

        .modal-close:hover {
            color: #333;
        }

        .action-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .action-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .action-type-pikmi {
            color: #27ae60;
        }

        .action-type-eball {
            color: #e74c3c;
        }

        .action-text {
            color: #666;
            margin-bottom: 10px;
        }

        .action-photo {
            max-width: 100%;
            border-radius: 8px;
            margin-top: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
        }

        .actions-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .number-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .number-input-group button {
            width: 40px;
            padding: 10px;
        }

        .number-input-group input {
            text-align: center;
            font-weight: bold;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–æ—Ñ–∏–ª—è */
        .profile-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .profile-avatar-large {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: block;
            border: 4px solid #667eea;
            object-fit: cover;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .profile-avatar-large-placeholder {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
            font-size: 48px;
            border: 4px solid #667eea;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .profile-name {
            font-size: 28px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 30px 0;
        }

        .profile-stat-card {
            background: linear-gradient(135deg, #f8f9ff 0%, #f0f4ff 100%);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #e0e0e0;
            transition: transform 0.2s;
        }

        .profile-stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .profile-stat-value {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .profile-stat-label {
            font-size: 14px;
            color: #666;
        }

        .profile-section {
            margin-top: 30px;
        }

        .profile-section-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .profile-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .profile-actions button {
            flex: 1;
        }

        /* –í–∫–ª–∞–¥–∫–∏ */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }

        .tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
            margin: 0;
            width: auto;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* –ö–∞–ª–µ–Ω–¥–∞—Ä—å */
        .calendar {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-nav-btn {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 18px;
            width: auto;
            margin: 0;
        }

        .calendar-nav-btn:hover {
            background: #764ba2;
        }

        .calendar-month {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        .calendar-day-header {
            text-align: center;
            font-weight: 600;
            color: #666;
            padding: 10px;
            font-size: 12px;
        }

        .calendar-day {
            aspect-ratio: 1;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
            border: 2px solid #e0e0e0;
            font-weight: 600;
            color: #333;
        }

        .calendar-day:hover {
            background: #f0f4ff;
            border-color: #667eea;
            transform: scale(1.05);
        }

        .calendar-day.has-events {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .calendar-day.today {
            border: 3px solid #27ae60;
            font-weight: bold;
        }

        .calendar-day.other-month {
            color: #ccc;
            background: #f5f5f5;
        }

        /* –†–µ–π—Ç–∏–Ω–≥ –ø–∏–∫–º–∏ */
        .pikmi-rating {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.2);
            padding: 15px 20px;
            z-index: 100;
            border-top: 3px solid #27ae60;
        }

        .pikmi-rating-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-around;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .pikmi-rating-item {
            text-align: center;
            flex: 1;
            min-width: 150px;
        }

        .pikmi-rating-title {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .pikmi-rating-winner {
            font-size: 16px;
            font-weight: bold;
            color: #27ae60;
        }

        .pikmi-rating-count {
            font-size: 14px;
            color: #999;
        }

        /* –ì–∞–ª–µ—Ä–µ—è Instagram-—Å—Ç–∏–ª—å */
        .profile-gallery {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2px;
            margin-top: 20px;
            background: #e0e0e0;
        }

        .gallery-item {
            aspect-ratio: 1;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            background: #f0f0f0;
        }

        .gallery-item img,
        .gallery-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .gallery-item:hover img,
        .gallery-item:hover video {
            transform: scale(1.1);
        }

        .gallery-item-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            color: white;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .gallery-item:hover .gallery-item-overlay {
            opacity: 1;
        }

        .gallery-item-type {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 20px;
            z-index: 2;
        }

        /* –ö–†–ò–ù–ñ –≤–∫–ª–∞–¥–∫–∞ */
        .cringe-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .cringe-stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .cringe-stat-value {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .cringe-stat-label {
            font-size: 16px;
            opacity: 0.9;
        }

        .cringe-timeline {
            margin-top: 30px;
        }

        .cringe-timeline-item {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }

        .cringe-timeline-date {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
        }

        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ */
        .settings-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .settings-section-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }

        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .settings-item-label {
            font-size: 16px;
            color: #333;
        }

        .settings-item-value {
            font-size: 14px;
            color: #666;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 26px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #667eea;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è —Ä–µ–π—Ç–∏–Ω–≥–∞ */
        @media (max-width: 768px) {
            .pikmi-rating-content {
                flex-direction: column;
                gap: 10px;
            }

            .pikmi-rating-item {
                min-width: 100%;
            }

            .main-content {
                padding-bottom: 150px;
            }
        }

        .main-content {
            padding-bottom: 20px;
        }

        /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ */
        body.dark-theme {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
        }

        body.dark-theme .container {
            background: #2d2d2d;
            color: #e0e0e0;
        }

        body.dark-theme h1,
        body.dark-theme h2 {
            color: #e0e0e0;
        }

        body.dark-theme .user-card {
            background: #3a3a3a;
            color: #e0e0e0;
        }

        body.dark-theme .user-card:hover {
            background: #4a4a4a;
        }

        body.dark-theme .stat-card {
            background: #3a3a3a;
        }

        body.dark-theme .modal-content {
            background: #2d2d2d;
            color: #e0e0e0;
        }

        body.dark-theme .action-item {
            background: #3a3a3a;
            color: #e0e0e0;
        }

        body.dark-theme .calendar {
            background: #3a3a3a;
        }

        body.dark-theme .calendar-day {
            background: #2d2d2d;
            color: #e0e0e0;
            border-color: #555;
        }

        body.dark-theme .calendar-day:hover {
            background: #4a4a4a;
        }

        body.dark-theme .cringe-stat-card {
            background: linear-gradient(135deg, #3a3a3a 0%, #4a4a4a 100%);
        }

        body.dark-theme .cringe-timeline-item {
            background: #3a3a3a;
            color: #e0e0e0;
        }

        body.dark-theme .settings-section {
            background: #3a3a3a;
        }

        body.dark-theme input,
        body.dark-theme select,
        body.dark-theme textarea {
            background: #2d2d2d;
            color: #e0e0e0;
            border-color: #555;
        }

        body.dark-theme .profile-stat-card {
            background: #3a3a3a;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 15px;
                margin: 10px auto;
                border-radius: 15px;
            }

            h1 {
                font-size: 1.5em;
                margin-bottom: 20px;
            }

            h2 {
                font-size: 1.2em;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .header > div:first-child {
                width: 100%;
            }

            .header > div:last-child {
                width: 100%;
                justify-content: space-between;
            }

            .tabs {
                flex-wrap: wrap;
                gap: 5px;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .tab {
                padding: 10px 15px;
                font-size: 13px;
                white-space: nowrap;
                min-width: auto;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .stat-card {
                padding: 15px;
            }

            .stat-value {
                font-size: 24px;
            }

            .user-card {
                padding: 15px;
                margin-bottom: 10px;
            }

            .user-info {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }

            .user-avatar {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }

            .user-name {
                font-size: 16px;
            }

            .rating-display {
                justify-content: center;
                gap: 15px;
                flex-wrap: wrap;
            }

            .total-rating {
                font-size: 20px;
            }

            .modal-content {
                padding: 20px;
                max-width: 95%;
                max-height: 90vh;
            }

            .calendar {
                padding: 15px;
            }

            .calendar-header {
                flex-wrap: wrap;
                gap: 10px;
            }

            .calendar-month {
                font-size: 16px;
            }

            .calendar-grid {
                gap: 4px;
            }

            .calendar-day {
                font-size: 11px;
                padding: 5px;
                min-height: 35px;
            }

            .calendar-day-header {
                font-size: 10px;
                padding: 8px 4px;
            }

            .profile-gallery {
                grid-template-columns: repeat(3, 1fr);
                gap: 1px;
            }

            .cringe-stats {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .cringe-stat-value {
                font-size: 36px;
            }

            .cringe-timeline-item {
                padding: 15px;
            }

            .pikmi-rating-calendar {
                padding: 15px;
            }

            .pikmi-rating-content {
                flex-direction: column;
                gap: 15px;
            }

            .pikmi-rating-item {
                min-width: 100%;
                padding: 15px;
                background: #f8f9fa;
                border-radius: 8px;
            }

            .pikmi-rating-winner {
                font-size: 18px;
            }

            .slider-container {
                margin: 15px 0;
            }

            .slider-value-display {
                font-size: 36px;
            }

            .slider-quick-buttons {
                gap: 8px;
            }

            .slider-quick-btn {
                padding: 6px 12px;
                font-size: 12px;
            }

            .profile-stats {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .profile-stat-value {
                font-size: 28px;
            }

            .action-item {
                padding: 12px;
            }

            .action-photo {
                max-width: 100%;
                height: auto;
            }

            .settings-item {
                flex-wrap: wrap;
                gap: 10px;
            }

            .btn-small {
                padding: 6px 12px;
                font-size: 12px;
            }

            body.dark-theme .pikmi-rating-item {
                background: #3a3a3a;
            }

            /* –£–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –∫–Ω–æ–ø–æ–∫ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
            button {
                padding: 12px;
                font-size: 14px;
            }

            .user-card button {
                padding: 10px;
                font-size: 13px;
            }
        }

        .pikmi-rating-calendar {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        body.dark-theme .pikmi-rating-calendar {
            background: #3a3a3a;
        }
    </style>
</head>
<body>
    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div id="loginPage" class="container">
        <h1>üîê –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h1>
        <div class="input-group">
            <label>–õ–æ–≥–∏–Ω</label>
            <input type="text" id="loginInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω">
        </div>
        <div class="input-group">
            <label>–ü–∞—Ä–æ–ª—å</label>
            <input type="password" id="passwordInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" autocomplete="current-password">
        </div>
        <div style="display: flex; align-items: center; gap: 8px; margin-top: 10px; margin-bottom: 10px;">
            <input type="checkbox" id="rememberMe" style="width: auto; cursor: pointer;">
            <label for="rememberMe" style="margin: 0; font-weight: normal; cursor: pointer; color: #666;">–ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è</label>
        </div>
        <button onclick="login()">–í–æ–π—Ç–∏</button>
        <div id="loginError" class="error hidden"></div>
    </div>

    <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
    <div id="mainPage" class="container hidden main-content" style="max-width: 1200px;">
        <div class="header">
            <div>
                <h1>üìä –†–µ–π—Ç–∏–Ω–≥–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</h1>
                <div style="color: #666; margin-top: 5px;">–ü—Ä–∏–≤–µ—Ç, <span id="currentUserName" style="font-weight: 600; color: #667eea;"></span>!</div>
            </div>
            <div style="display: flex; gap: 10px; align-items: center;">
                <button class="btn-secondary btn-small" onclick="openSettings()">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                <button class="btn-danger btn-small" onclick="logout()">–í—ã–π—Ç–∏</button>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('main')">üè† –ì–ª–∞–≤–Ω–∞—è</button>
            <button class="tab" onclick="switchTab('calendar')">üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å</button>
            <button class="tab" onclick="switchTab('voting')">‚≠ê –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ</button>
            <button class="tab" onclick="switchTab('cringe')">üíÄ –ö–†–ò–ù–ñ</button>
            <button class="tab" onclick="switchTab('myProfile')">üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</button>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞: –ì–ª–∞–≤–Ω–∞—è -->
        <div id="tab-main" class="tab-content active">
            <div class="stats-grid" id="myStats"></div>
            <h2 style="margin-top: 30px;">–£—á–∞—Å—Ç–Ω–∏–∫–∏</h2>
            <div id="usersList"></div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞: –ö–∞–ª–µ–Ω–¥–∞—Ä—å -->
        <div id="tab-calendar" class="tab-content">
            <div id="pikmiRatingCalendar"></div>
            <div id="calendarContainer"></div>
            <div id="calendarEvents"></div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞: –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ -->
        <div id="tab-voting" class="tab-content">
            <div id="votingContent"></div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞: –ö–†–ò–ù–ñ -->
        <div id="tab-cringe" class="tab-content">
            <div id="cringeContent"></div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞: –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å -->
        <div id="tab-myProfile" class="tab-content">
            <div id="myProfileContent"></div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ -->
    <div id="voteModal" class="modal hidden">
        <div class="modal-content">
            <span class="modal-close" onclick="closeVoteModal()">&times;</span>
            <h2 id="voteModalTitle"></h2>
            
            <div class="input-group">
                <label>–¢–∏–ø –æ—Ü–µ–Ω–∫–∏</label>
                <select id="voteType" onchange="updateVoteTypeInfo()">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
                    <option value="pikmi">‚≠ê Pikmi Move (—Ö–æ—Ä–æ—à–∏–π –±–∞–ª–ª)</option>
                    <option value="eball">‚ö†Ô∏è E-Ball (–ø–ª–æ—Ö–æ–π –±–∞–ª–ª)</option>
                </select>
            </div>

            <div id="voteTypeInfo" class="hidden" style="padding: 10px; border-radius: 8px; margin-bottom: 15px;"></div>

            <div class="input-group">
                <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤</label>
                <div class="slider-container">
                    <div class="slider-value-display" id="sliderValueDisplay">1</div>
                    <div class="slider-wrapper">
                        <input type="range" id="voteAmountSlider" class="slider" min="1" max="10" value="1" step="1" oninput="updateSliderValue(this.value)">
                        <div class="slider-labels">
                            <span>1</span>
                            <span>10</span>
                        </div>
                    </div>
                    <div class="slider-quick-buttons">
                        <div class="slider-quick-btn" onclick="setSliderValue(1)">1</div>
                        <div class="slider-quick-btn" onclick="setSliderValue(3)">3</div>
                        <div class="slider-quick-btn" onclick="setSliderValue(5)">5</div>
                        <div class="slider-quick-btn" onclick="setSliderValue(7)">7</div>
                        <div class="slider-quick-btn" onclick="setSliderValue(10)">10</div>
                    </div>
                </div>
            </div>

            <div class="input-group">
                <label>–û–ø–∏—Å–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                <textarea id="proofText" rows="4" placeholder="–û–ø–∏—à–∏—Ç–µ, –∑–∞ —á—Ç–æ —Å—Ç–∞–≤–∏—Ç–µ –±–∞–ª–ª..."></textarea>
            </div>

            <div class="input-group">
                <label>–§–æ—Ç–æ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                <div class="file-input-wrapper">
                    <input type="file" id="proofFile" accept="image/*,video/*" onchange="updateFileName()">
                    <div class="file-label" id="fileLabel">üìé –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª</div>
                </div>
            </div>

            <button onclick="submitVote()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É</button>
            <div id="voteMessage" class="hidden"></div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ–π—Å—Ç–≤–∏–π -->
    <div id="actionsModal" class="modal hidden">
        <div class="modal-content">
            <span class="modal-close" onclick="closeActionsModal()">&times;</span>
            <h2 id="actionsModalTitle"></h2>
            <div class="actions-list" id="actionsList"></div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–∞ -->
    <div id="profileModal" class="modal hidden">
        <div class="modal-content" style="max-width: 700px;">
            <span class="modal-close" onclick="closeProfileModal()">&times;</span>
            <div id="profileContent">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div id="settingsModal" class="modal hidden">
        <div class="modal-content" style="max-width: 600px;">
            <span class="modal-close" onclick="closeSettings()">&times;</span>
            <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            <div id="settingsContent">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>

    <script>
        // –ü–†–ê–í–ò–õ–¨–ù–´–ï –ö–õ–Æ–ß–ò SUPABASE
        const SUPABASE_URL = 'https://qlghihbbwbudwhjbyibu.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFsZ2hpaGJid2J1ZHdoamJ5aWJ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzMTI4NzksImV4cCI6MjA3ODg4ODg3OX0.JEEuOEPuRXFddlImN4tuzBgSbf-Xr-dg257DFDxfwIk';

        // –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è - –∏—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç
        const { createClient } = window.supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        let currentUser = null;
        let selectedUser = null;

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('DOMContentLoaded', () => {
            loadSavedCredentials();
            checkSavedSession();
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ª–æ–≥–∏–Ω–∞/–ø–∞—Ä–æ–ª—è
        function loadSavedCredentials() {
            const savedLogin = localStorage.getItem('savedLogin');
            const rememberMe = localStorage.getItem('rememberMe') === 'true';
            
            if (savedLogin && rememberMe) {
                document.getElementById('loginInput').value = savedLogin;
                if (document.getElementById('rememberMe')) {
                    document.getElementById('rememberMe').checked = true;
                }
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏
        async function checkSavedSession() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å–µ –µ—â–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                    const { data, error } = await supabaseClient.rpc('check_login', {
                        p_login: currentUser.login,
                        p_password: localStorage.getItem('userPassword') || ''
                    });
                    
                    if (!error && data && data.length > 0) {
                        currentUser = data[0];
                        showMainPage();
                    } else {
                        // –°–µ—Å—Å–∏—è –Ω–µ–≤–∞–ª–∏–¥–Ω–∞, –æ—á–∏—â–∞–µ–º
                        localStorage.removeItem('currentUser');
                        localStorage.removeItem('userPassword');
                    }
                } catch (error) {
                    console.error('Session check error:', error);
                    localStorage.removeItem('currentUser');
                    localStorage.removeItem('userPassword');
                }
            }
        }

        // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
        async function login() {
            const login = document.getElementById('loginInput').value.trim();
            const password = document.getElementById('passwordInput').value.trim();
            const rememberMe = document.getElementById('rememberMe').checked;
            const errorDiv = document.getElementById('loginError');

            if (!login || !password) {
                showMessage(errorDiv, '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }

            try {
                const { data, error } = await supabaseClient.rpc('check_login', {
                    p_login: login,
                    p_password: password
                });

                if (error) {
                    console.error('RPC error:', error);
                    throw error;
                }

                if (data && data.length > 0) {
                    currentUser = data[0];
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                    if (rememberMe) {
                        localStorage.setItem('savedLogin', login);
                        localStorage.setItem('rememberMe', 'true');
                        localStorage.setItem('userPassword', password); // –í—Ä–µ–º–µ–Ω–Ω–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ—Å—Å–∏–∏
                    } else {
                        localStorage.removeItem('savedLogin');
                        localStorage.removeItem('rememberMe');
                    }
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–µ—Å—Å–∏—é
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    showMainPage();
                } else {
                    showMessage(errorDiv, '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å', 'error');
                    // –ù–µ –æ—á–∏—â–∞–µ–º –ø–æ–ª—è –ø—Ä–∏ –æ—à–∏–±–∫–µ
                }
            } catch (error) {
                console.error('Login error:', error);
                showMessage(errorDiv, '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message, 'error');
                // –ù–µ –æ—á–∏—â–∞–µ–º –ø–æ–ª—è –ø—Ä–∏ –æ—à–∏–±–∫–µ
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        async function showMainPage() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('mainPage').classList.remove('hidden');
            document.getElementById('currentUserName').textContent = currentUser.name;
            loadTheme();
            await loadMyStats();
            await loadUsers();
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
        function toggleTheme() {
            const toggle = document.getElementById('themeToggleSettings') || document.getElementById('themeToggle');
            if (!toggle) return;
            
            const isDark = toggle.checked;
            if (isDark) {
                document.body.classList.add('dark-theme');
                localStorage.setItem('theme', 'dark');
            } else {
                document.body.classList.remove('dark-theme');
                localStorage.setItem('theme', 'light');
            }
            
            // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –æ–±–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
            const toggle1 = document.getElementById('themeToggleSettings');
            const toggle2 = document.getElementById('themeToggle');
            if (toggle1 && toggle2) {
                toggle1.checked = isDark;
                toggle2.checked = isDark;
            }
        }

        function loadTheme() {
            const theme = localStorage.getItem('theme');
            if (theme === 'dark') {
                document.body.classList.add('dark-theme');
                const toggle = document.getElementById('themeToggleSettings') || document.getElementById('themeToggle');
                if (toggle) toggle.checked = true;
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function switchTab(tabName) {
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach((tab, index) => {
                const tabNames = ['main', 'calendar', 'voting', 'cringe', 'myProfile'];
                if (tabNames[index] === tabName) {
                    tab.classList.add('active');
                }
            });
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–∫–∏
            if (tabName === 'calendar') {
                loadCalendar();
                loadPikmiRating();
            } else if (tabName === 'voting') {
                loadVotingTab();
            } else if (tabName === 'cringe') {
                loadCringeTab();
            } else if (tabName === 'myProfile') {
                loadMyProfile();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–π—Ç–∏–Ω–≥ –ø–∏–∫–º–∏ (–¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è)
        async function loadPikmiRating() {
            const container = document.getElementById('pikmiRatingCalendar');
            if (!container) return;
            try {
                const { data: allScores, error } = await supabaseClient
                    .from('scores')
                    .select('*');

                if (error) throw error;

                const { data: users, error: usersError } = await supabaseClient
                    .from('users')
                    .select('*');

                if (usersError) throw usersError;

                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const weekAgo = new Date(today);
                weekAgo.setDate(weekAgo.getDate() - 7);
                const monthAgo = new Date(today);
                monthAgo.setMonth(monthAgo.getMonth() - 1);

                // –†–µ–π—Ç–∏–Ω–≥ –¥–Ω—è (—Ç–µ–ø–µ—Ä—å pikmi –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ 1)
                const dayScores = allScores.filter(s => new Date(s.created_at) >= today);
                const dayRatings = {};
                dayScores.forEach(s => {
                    if (s.pikmi > 0) {
                        dayRatings[s.user_name] = (dayRatings[s.user_name] || 0) + (s.pikmi || 0);
                    }
                });
                const dayKeys = Object.keys(dayRatings);
                const dayWinner = dayKeys.length > 0 
                    ? dayKeys.reduce((a, b) => dayRatings[a] > dayRatings[b] ? a : b)
                    : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';

                // –†–µ–π—Ç–∏–Ω–≥ –Ω–µ–¥–µ–ª–∏ (—Ç–µ–ø–µ—Ä—å pikmi –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ 1)
                const weekScores = allScores.filter(s => new Date(s.created_at) >= weekAgo);
                const weekRatings = {};
                weekScores.forEach(s => {
                    if (s.pikmi > 0) {
                        weekRatings[s.user_name] = (weekRatings[s.user_name] || 0) + (s.pikmi || 0);
                    }
                });
                const weekKeys = Object.keys(weekRatings);
                const weekWinner = weekKeys.length > 0
                    ? weekKeys.reduce((a, b) => weekRatings[a] > weekRatings[b] ? a : b)
                    : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';

                // –†–µ–π—Ç–∏–Ω–≥ –º–µ—Å—è—Ü–∞ (—Ç–µ–ø–µ—Ä—å pikmi –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ 1)
                const monthScores = allScores.filter(s => new Date(s.created_at) >= monthAgo);
                const monthRatings = {};
                monthScores.forEach(s => {
                    if (s.pikmi > 0) {
                        monthRatings[s.user_name] = (monthRatings[s.user_name] || 0) + (s.pikmi || 0);
                    }
                });
                const monthKeys = Object.keys(monthRatings);
                const monthWinner = monthKeys.length > 0
                    ? monthKeys.reduce((a, b) => monthRatings[a] > monthRatings[b] ? a : b)
                    : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';

                const ratingHTML = `
                    <div class="pikmi-rating-item">
                        <div class="pikmi-rating-title">‚≠ê –î–µ–Ω—å</div>
                        <div class="pikmi-rating-winner">${dayWinner}</div>
                        <div class="pikmi-rating-count">${dayRatings[dayWinner] || 0} –±–∞–ª–ª–æ–≤</div>
                    </div>
                    <div class="pikmi-rating-item">
                        <div class="pikmi-rating-title">‚≠ê –ù–µ–¥–µ–ª—è</div>
                        <div class="pikmi-rating-winner">${weekWinner}</div>
                        <div class="pikmi-rating-count">${weekRatings[weekWinner] || 0} –±–∞–ª–ª–æ–≤</div>
                    </div>
                    <div class="pikmi-rating-item">
                        <div class="pikmi-rating-title">‚≠ê –ú–µ—Å—è—Ü</div>
                        <div class="pikmi-rating-winner">${monthWinner}</div>
                        <div class="pikmi-rating-count">${monthRatings[monthWinner] || 0} –±–∞–ª–ª–æ–≤</div>
                    </div>
                `;

                container.innerHTML = `<div class="pikmi-rating-calendar">${ratingHTML}</div>`;
            } catch (error) {
                console.error('Load pikmi rating error:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å
        let currentCalendarDate = new Date();

        async function loadCalendar() {
            try {
                const { data: allScores, error } = await supabaseClient
                    .from('scores')
                    .select('*');

                if (error) throw error;

                const year = currentCalendarDate.getFullYear();
                const month = currentCalendarDate.getMonth();

                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                // –í JavaScript –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ = 0, –Ω–æ –Ω–∞–º –Ω—É–∂–µ–Ω –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ = 0
                let startingDayOfWeek = firstDay.getDay() - 1;
                if (startingDayOfWeek < 0) startingDayOfWeek = 6; // –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è 6

                // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏—è –ø–æ –¥–∞—Ç–∞–º
                const eventsByDate = {};
                allScores.forEach(score => {
                    const date = new Date(score.created_at);
                    const dateKey = `${date.getFullYear()}-${date.getMonth()}-${date.getDate()}`;
                    if (!eventsByDate[dateKey]) {
                        eventsByDate[dateKey] = [];
                    }
                    eventsByDate[dateKey].push(score);
                });

                let calendarHTML = `
                    <div class="calendar">
                        <div class="calendar-header">
                            <button class="calendar-nav-btn" onclick="changeCalendarMonth(-1)">‚Äπ</button>
                            <div class="calendar-month">${firstDay.toLocaleString('ru-RU', { month: 'long', year: 'numeric' })}</div>
                            <button class="calendar-nav-btn" onclick="changeCalendarMonth(1)">‚Ä∫</button>
                        </div>
                        <div class="calendar-grid">
                            <div class="calendar-day-header">–ü–Ω</div>
                            <div class="calendar-day-header">–í—Ç</div>
                            <div class="calendar-day-header">–°—Ä</div>
                            <div class="calendar-day-header">–ß—Ç</div>
                            <div class="calendar-day-header">–ü—Ç</div>
                            <div class="calendar-day-header">–°–±</div>
                            <div class="calendar-day-header">–í—Å</div>
                `;

                // –ü—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –¥–æ –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è –º–µ—Å—è—Ü–∞
                for (let i = 0; i < startingDayOfWeek; i++) {
                    calendarHTML += `<div class="calendar-day other-month"></div>`;
                }

                // –î–Ω–∏ –º–µ—Å—è—Ü–∞
                const today = new Date();
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateKey = `${year}-${month}-${day}`;
                    const hasEvents = eventsByDate[dateKey] && eventsByDate[dateKey].length > 0;
                    const isToday = today.getDate() === day && today.getMonth() === month && today.getFullYear() === year;
                    
                    let dayClass = 'calendar-day';
                    if (hasEvents) dayClass += ' has-events';
                    if (isToday) dayClass += ' today';

                    calendarHTML += `
                        <div class="${dayClass}" onclick="showCalendarDay('${year}-${month}-${day}')">
                            ${day}
                        </div>
                    `;
                }

                calendarHTML += `</div></div>`;
                document.getElementById('calendarContainer').innerHTML = calendarHTML;
            } catch (error) {
                console.error('Load calendar error:', error);
            }
        }

        function changeCalendarMonth(delta) {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + delta);
            loadCalendar();
        }

        async function showCalendarDay(dateKey) {
            const [year, month, day] = dateKey.split('-');
            const date = new Date(year, month, day);
            
            try {
                const { data: scores, error } = await supabaseClient
                    .from('scores')
                    .select('*')
                    .gte('created_at', date.toISOString())
                    .lt('created_at', new Date(date.getTime() + 86400000).toISOString());

                if (error) throw error;

                if (scores.length === 0) {
                    document.getElementById('calendarEvents').innerHTML = 
                        '<p style="text-align: center; color: #999; padding: 20px;">–í —ç—Ç–æ—Ç –¥–µ–Ω—å –Ω–µ –±—ã–ª–æ –æ—Ü–µ–Ω–æ–∫</p>';
                    return;
                }

                const eventsHTML = `
                    <h3 style="margin: 20px 0;">–°–æ–±—ã—Ç–∏—è ${date.toLocaleDateString('ru-RU')}</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
                        ${scores.map(score => {
                            const type = (score.pikmi || 0) > 0 ? 'pikmi' : 'eball';
                            const typeText = type === 'pikmi' ? '‚≠ê Pikmi Move' : '‚ö†Ô∏è E-Ball';
                            const typeClass = type === 'pikmi' ? 'action-type-pikmi' : 'action-type-eball';
                            const time = new Date(score.created_at).toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
                            const isVideo = score.proof_file_type && score.proof_file_type.startsWith('video/');
                            
                            return `
                                <div class="action-item">
                                    <div class="action-header">
                                        <span class="${typeClass}">${typeText}</span>
                                        <span style="color: #999; font-size: 12px;">${time}</span>
                                    </div>
                                    <div style="color: #666; font-size: 14px; margin-bottom: 5px;">
                                        ${score.user_name} ‚Üê ${score.voter_name}
                                    </div>
                                    <div class="action-text">${score.proof_text || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}</div>
                                    ${score.proof_file_url ? `
                                        ${isVideo 
                                            ? `<video src="${score.proof_file_url}" class="action-photo" controls style="width: 100%; border-radius: 8px;"></video>`
                                            : `<img src="${score.proof_file_url}" class="action-photo" alt="–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ" style="cursor: pointer;" onclick="window.open('${score.proof_file_url}', '_blank')">`
                                        }
                                    ` : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;

                document.getElementById('calendarEvents').innerHTML = eventsHTML;
            } catch (error) {
                console.error('Show calendar day error:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∫–ª–∞–¥–∫—É –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ
        async function loadVotingTab() {
            try {
                const { data: allScores, error } = await supabaseClient
                    .from('scores')
                    .select('*');

                if (error) throw error;

                const { data: users, error: usersError } = await supabaseClient
                    .from('users')
                    .select('*');

                if (usersError) throw usersError;

                // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥ (—Ç–µ–ø–µ—Ä—å pikmi –∏ eball –º–æ–≥—É—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ 1)
                const ratings = {};
                users.forEach(user => {
                    const userScores = allScores.filter(s => s.user_name === user.name);
                    const pikmiCount = userScores.reduce((sum, s) => sum + (s.pikmi || 0), 0);
                    const eballCount = userScores.reduce((sum, s) => sum + (s.eball || 0), 0);
                    ratings[user.name] = {
                        pikmi: pikmiCount,
                        eball: eballCount,
                        total: pikmiCount - eballCount,
                        photo: user.photo_url,
                        login: user.login
                    };
                });

                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –æ–±—â–µ–º—É —Ä–µ–π—Ç–∏–Ω–≥—É
                const sortedUsers = Object.entries(ratings)
                    .sort((a, b) => b[1].total - a[1].total)
                    .map(([name, data]) => ({ name, ...data }));

                const votingHTML = `
                    <h2 style="margin-bottom: 30px; text-align: center;">üèÜ –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –∑–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</h2>
                    <div style="display: grid; gap: 20px;">
                        ${sortedUsers.map((user, index) => {
                            const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
                            const avatarHTML = user.photo
                                ? `<img src="${user.photo}" alt="${user.name}" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 3px solid #667eea;">`
                                : `<div style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 32px; border: 3px solid #667eea;">${user.name.charAt(0).toUpperCase()}</div>`;
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–µ–º –ª–∏ –º—ã –≥–æ–ª–æ—Å–æ–≤–∞—Ç—å –∑–∞ —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                            const canVote = user.login !== currentUser.login;
                            
                            return `
                                <div class="user-card" style="display: flex; align-items: center; gap: 20px; padding: 25px; flex-wrap: wrap;">
                                    <div style="font-size: 32px; font-weight: bold; min-width: 60px; text-align: center;">${medal}</div>
                                    ${avatarHTML}
                                    <div style="flex: 1; min-width: 200px;">
                                        <div style="font-size: 24px; font-weight: bold; margin-bottom: 10px;">${user.name}</div>
                                        <div style="display: flex; gap: 20px; font-size: 16px; flex-wrap: wrap; margin-bottom: 15px;">
                                            <div><span style="color: #27ae60; font-weight: bold;">‚≠ê ${user.pikmi}</span> Pikmi</div>
                                            <div><span style="color: #e74c3c; font-weight: bold;">‚ö†Ô∏è ${user.eball}</span> E-Ball</div>
                                            <div><span style="color: #667eea; font-weight: bold; font-size: 20px;">üìä ${user.total}</span> –†–µ–π—Ç–∏–Ω–≥</div>
                                        </div>
                                        ${canVote ? `
                                            <div style="display: flex; gap: 10px;">
                                                <button onclick="quickVote('${user.name}', 'pikmi')" class="btn-success btn-small" style="flex: 1;">üëç +1 Pikmi</button>
                                                <button onclick="quickVote('${user.name}', 'eball')" class="btn-danger btn-small" style="flex: 1;">üëé +1 E-Ball</button>
                                            </div>
                                        ` : '<div style="color: #999; font-size: 14px;">–≠—Ç–æ –≤—ã</div>'}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;

                document.getElementById('votingContent').innerHTML = votingHTML;
            } catch (error) {
                console.error('Load voting tab error:', error);
            }
        }

        // –ë—ã—Å—Ç—Ä–æ–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –∏–∑ –≤–∫–ª–∞–¥–∫–∏ –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ
        async function quickVote(userName, voteType) {
            if (!confirm(`–ü–æ—Å—Ç–∞–≤–∏—Ç—å ${voteType === 'pikmi' ? 'Pikmi Move' : 'E-Ball'} –¥–ª—è ${userName}?`)) {
                return;
            }

            try {
                const record = {
                    user_name: userName,
                    voter_login: currentUser.login,
                    voter_name: currentUser.name,
                    pikmi: voteType === 'pikmi' ? 1 : 0,
                    eball: voteType === 'eball' ? 1 : 0,
                    proof_text: `–ë—ã—Å—Ç—Ä–æ–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ"`,
                    proof_file_url: null,
                    proof_file_name: null,
                    proof_file_type: null
                };

                const { error: insertError } = await supabaseClient
                    .from('scores')
                    .insert(record);

                if (insertError) {
                    console.error('Insert error:', insertError);
                    throw insertError;
                }

                alert(`‚úÖ ${voteType === 'pikmi' ? 'Pikmi Move' : 'E-Ball'} —É—Å–ø–µ—à–Ω–æ –ø–æ—Å—Ç–∞–≤–ª–µ–Ω!`);
                loadVotingTab();
                loadMyStats();
                loadUsers();
            } catch (error) {
                console.error('Quick vote error:', error);
                alert('–û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∫–ª–∞–¥–∫—É –ö–†–ò–ù–ñ
        async function loadCringeTab() {
            try {
                const { data: allScores, error } = await supabaseClient
                    .from('scores')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                const { data: users, error: usersError } = await supabaseClient
                    .from('users')
                    .select('*');

                if (usersError) throw usersError;

                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                const totalPikmi = allScores.reduce((sum, s) => sum + (s.pikmi || 0), 0);
                const totalEball = allScores.reduce((sum, s) => sum + (s.eball || 0), 0);
                const totalActions = allScores.length;
                const uniqueUsers = new Set(allScores.map(s => s.user_name)).size;

                // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–∞–º
                const scoresByDate = {};
                allScores.forEach(score => {
                    const date = new Date(score.created_at);
                    const dateKey = date.toLocaleDateString('ru-RU');
                    if (!scoresByDate[dateKey]) {
                        scoresByDate[dateKey] = [];
                    }
                    scoresByDate[dateKey].push(score);
                });

                const dates = Object.keys(scoresByDate).sort((a, b) => 
                    new Date(b.split('.').reverse().join('-')) - new Date(a.split('.').reverse().join('-'))
                );

                const cringeHTML = `
                    <div class="cringe-stats">
                        <div class="cringe-stat-card">
                            <div class="cringe-stat-value">${totalActions}</div>
                            <div class="cringe-stat-label">–í—Å–µ–≥–æ –æ—Ü–µ–Ω–æ–∫</div>
                        </div>
                        <div class="cringe-stat-card" style="background: linear-gradient(135deg, #27ae60 0%, #229954 100%);">
                            <div class="cringe-stat-value">${totalPikmi}</div>
                            <div class="cringe-stat-label">Pikmi Move</div>
                        </div>
                        <div class="cringe-stat-card" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
                            <div class="cringe-stat-value">${totalEball}</div>
                            <div class="cringe-stat-label">E-Ball</div>
                        </div>
                        <div class="cringe-stat-card" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);">
                            <div class="cringe-stat-value">${uniqueUsers}</div>
                            <div class="cringe-stat-label">–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>
                        </div>
                    </div>

                    <div class="cringe-timeline">
                        <h2 style="margin-bottom: 20px;">üìÖ –ò—Å—Ç–æ—Ä–∏—è –ø–æ –¥–∞—Ç–∞–º</h2>
                        ${dates.map(date => {
                            const dayScores = scoresByDate[date];
                            const dayPikmi = dayScores.reduce((sum, s) => sum + (s.pikmi || 0), 0);
                            const dayEball = dayScores.reduce((sum, s) => sum + (s.eball || 0), 0);
                            
                            return `
                                <div class="cringe-timeline-item" style="cursor: pointer;" onclick="switchToCalendarDate('${date}')">
                                    <div class="cringe-timeline-date">${date} (–Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å)</div>
                                    <div style="display: flex; gap: 20px; margin-bottom: 15px;">
                                        <span style="color: #27ae60; font-weight: bold;">‚≠ê Pikmi: ${dayPikmi}</span>
                                        <span style="color: #e74c3c; font-weight: bold;">‚ö†Ô∏è E-Ball: ${dayEball}</span>
                                        <span style="color: #666;">–í—Å–µ–≥–æ: ${dayScores.length}</span>
                                    </div>
                                    <div style="max-height: 200px; overflow-y: auto;">
                                        ${dayScores.map(score => {
                                            const type = (score.pikmi || 0) > 0 ? 'pikmi' : 'eball';
                                            const typeText = type === 'pikmi' ? '‚≠ê' : '‚ö†Ô∏è';
                                            const time = new Date(score.created_at).toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
                                            return `
                                                <div style="padding: 10px; background: #f8f9fa; border-radius: 8px; margin-bottom: 10px;">
                                                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                                        <span><strong>${score.user_name}</strong> ‚Üê ${score.voter_name}</span>
                                                        <span style="color: #999; font-size: 12px;">${time}</span>
                                                    </div>
                                                    <div style="color: #666;">${typeText} ${score.proof_text || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}</div>
                                                </div>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;

                document.getElementById('cringeContent').innerHTML = cringeHTML;
            } catch (error) {
                console.error('Load cringe tab error:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–π –ø—Ä–æ—Ñ–∏–ª—å
        async function loadMyProfile() {
            try {
                const { data: myScores, error } = await supabaseClient
                    .from('scores')
                    .select('*')
                    .eq('user_name', currentUser.name)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                const { data: users, error: usersError } = await supabaseClient
                    .from('users')
                    .select('*')
                    .eq('name', currentUser.name);

                if (usersError) throw usersError;

                const user = users && users.length > 0 ? users[0] : null;
                const userPhotoUrl = user?.photo_url || '';

                const pikmiCount = myScores.reduce((sum, s) => sum + (s.pikmi || 0), 0);
                const eballCount = myScores.reduce((sum, s) => sum + (s.eball || 0), 0);
                const totalRating = pikmiCount - eballCount;

                // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã –¥–ª—è –≥–∞–ª–µ—Ä–µ–∏
                const files = myScores.filter(s => s.proof_file_url).map(s => ({
                    url: s.proof_file_url,
                    type: s.proof_file_type,
                    text: s.proof_text,
                    date: s.created_at
                }));

                const avatarHTML = userPhotoUrl
                    ? `<img src="${userPhotoUrl}" alt="${currentUser.name}" class="profile-avatar-large">`
                    : `<div class="profile-avatar-large-placeholder">${currentUser.name.charAt(0).toUpperCase()}</div>`;

                const galleryHTML = files.length > 0 ? `
                    <div class="profile-section">
                        <div class="profile-section-title">üì∏ –ì–∞–ª–µ—Ä–µ—è (${files.length})</div>
                        <div class="profile-gallery">
                            ${files.map((file, index) => {
                                const isVideo = file.type && file.type.startsWith('video/');
                                return `
                                    <div class="gallery-item" onclick="openGalleryModal(${index}, ${JSON.stringify(files).replace(/"/g, '&quot;')})">
                                        ${isVideo 
                                            ? `<video src="${file.url}" muted></video><div class="gallery-item-type">üé•</div>`
                                            : `<img src="${file.url}" alt="–§–æ—Ç–æ">`
                                        }
                                        <div class="gallery-item-overlay">
                                            <span>üëÅÔ∏è</span>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                ` : '<p style="text-align: center; color: #999; padding: 20px;">–ü–æ–∫–∞ –Ω–µ—Ç —Ñ–æ—Ç–æ –∏ –≤–∏–¥–µ–æ</p>';

                const profileHTML = `
                    <div class="profile-header">
                        ${avatarHTML}
                        <div class="profile-name">${currentUser.name}</div>
                    </div>

                    <div class="profile-stats">
                        <div class="profile-stat-card" style="border-color: #27ae60;">
                            <div class="profile-stat-value" style="color: #27ae60;">${pikmiCount}</div>
                            <div class="profile-stat-label">‚≠ê Pikmi Move</div>
                        </div>
                        <div class="profile-stat-card" style="border-color: #e74c3c;">
                            <div class="profile-stat-value" style="color: #e74c3c;">${eballCount}</div>
                            <div class="profile-stat-label">‚ö†Ô∏è E-Ball</div>
                        </div>
                        <div class="profile-stat-card" style="border-color: #667eea;">
                            <div class="profile-stat-value" style="color: #667eea;">${totalRating}</div>
                            <div class="profile-stat-label">üìä –û–±—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥</div>
                        </div>
                    </div>

                    ${galleryHTML}

                    <div class="profile-section">
                        <div class="profile-section-title">üìù –ò—Å—Ç–æ—Ä–∏—è –æ—Ü–µ–Ω–æ–∫ (${myScores.length})</div>
                        <div class="actions-list" style="max-height: 400px;">
                            ${myScores.length === 0 
                                ? '<p style="text-align: center; color: #999; padding: 20px;">–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ü–µ–Ω–æ–∫</p>'
                                : myScores.map(action => {
                                    const date = new Date(action.created_at).toLocaleString('ru-RU');
                                    const type = (action.pikmi || 0) > 0 ? 'pikmi' : 'eball';
                                    const typeText = type === 'pikmi' ? '‚≠ê Pikmi Move' : '‚ö†Ô∏è E-Ball';
                                    const typeClass = type === 'pikmi' ? 'action-type-pikmi' : 'action-type-eball';
                                    
                                    return `
                                        <div class="action-item">
                                            <div class="action-header">
                                                <span class="${typeClass}">${typeText}</span>
                                                <span style="color: #999; font-size: 12px;">${date}</span>
                                            </div>
                                            <div style="color: #666; font-size: 14px; margin-bottom: 5px;">–û—Ç: ${action.voter_name}</div>
                                            <div class="action-text">${action.proof_text || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}</div>
                                            ${action.proof_file_url ? `<img src="${action.proof_file_url}" class="action-photo" alt="–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ">` : ''}
                                        </div>
                                    `;
                                }).join('')
                            }
                        </div>
                    </div>
                `;

                document.getElementById('myProfileContent').innerHTML = profileHTML;
            } catch (error) {
                console.error('Load my profile error:', error);
            }
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        function openSettings() {
            const currentTheme = localStorage.getItem('theme') === 'dark';
            const settingsHTML = `
                <div class="settings-section">
                    <div class="settings-section-title">üë§ –ü—Ä–æ—Ñ–∏–ª—å</div>
                    <div class="settings-item">
                        <div class="settings-item-label">–ò–º—è</div>
                        <div class="settings-item-value">${currentUser.name}</div>
                    </div>
                    <div class="settings-item">
                        <div class="settings-item-label">–õ–æ–≥–∏–Ω</div>
                        <div class="settings-item-value">${currentUser.login}</div>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-section-title">üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</div>
                    <div class="settings-item">
                        <div class="settings-item-label">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –æ—Ü–µ–Ω–∫–∞—Ö</div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-section-title">üé® –í–Ω–µ—à–Ω–∏–π –≤–∏–¥</div>
                    <div class="settings-item">
                        <div class="settings-item-label">–¢–µ–º–Ω–∞—è —Ç–µ–º–∞</div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="themeToggleSettings" ${currentTheme ? 'checked' : ''} onchange="toggleTheme()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-section-title">‚ÑπÔ∏è –û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</div>
                    <div class="settings-item">
                        <div class="settings-item-label">–í–µ—Ä—Å–∏—è</div>
                        <div class="settings-item-value">1.0.0</div>
                    </div>
                </div>
            `;

            document.getElementById('settingsContent').innerHTML = settingsHTML;
            document.getElementById('settingsModal').classList.remove('hidden');
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.add('hidden');
        }

        // –ü–µ—Ä–µ—Ö–æ–¥ –∫ –¥–∞—Ç–µ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ –∏–∑ –ö–†–ò–ù–ñ
        function switchToCalendarDate(dateStr) {
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É –∫–∞–ª–µ–Ω–¥–∞—Ä—è
            switchTab('calendar');
            
            // –ü–∞—Ä—Å–∏–º –¥–∞—Ç—É –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å
            const [day, month, year] = dateStr.split('.');
            currentCalendarDate = new Date(year, month - 1, day);
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è —ç—Ç–æ–≥–æ –¥–Ω—è
            setTimeout(() => {
                loadCalendar();
                const dateKey = `${year}-${month - 1}-${day}`;
                setTimeout(() => {
                    showCalendarDay(dateKey);
                }, 500);
            }, 100);
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –º–æ—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        async function loadMyStats() {
            try {
                const { data: myActions, error } = await supabaseClient
                    .from('scores')
                    .select('*')
                    .eq('user_name', currentUser.name);

                if (error) throw error;

                const pikmiCount = myActions.reduce((sum, a) => sum + (a.pikmi || 0), 0);
                const eballCount = myActions.reduce((sum, a) => sum + (a.eball || 0), 0);
                const totalRating = pikmiCount - eballCount;

                const statsHtml = `
                    <div class="stat-card" style="background: linear-gradient(135deg, #27ae60 0%, #229954 100%); color: white;">
                        <div class="stat-value">${pikmiCount}</div>
                        <div class="stat-label" style="color: rgba(255,255,255,0.9);">Pikmi Move</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white;">
                        <div class="stat-value">${eballCount}</div>
                        <div class="stat-label" style="color: rgba(255,255,255,0.9);">E-Ball</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                        <div class="stat-value">${totalRating}</div>
                        <div class="stat-label" style="color: rgba(255,255,255,0.9);">–û–±—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥</div>
                    </div>
                `;
                document.getElementById('myStats').innerHTML = statsHtml;
            } catch (error) {
                console.error('Load stats error:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        async function loadUsers() {
            try {
                const { data: users, error: usersError } = await supabaseClient
                    .from('users')
                    .select('*');

                if (usersError) throw usersError;

                const { data: allScores, error: scoresError } = await supabaseClient
                    .from('scores')
                    .select('*');

                if (scoresError) throw scoresError;

                const usersList = document.getElementById('usersList');
                usersList.innerHTML = '';

                users.forEach(user => {
                    if (user.login === currentUser.login) return;

                const userScores = allScores.filter(s => s.user_name === user.name);
                const pikmiCount = userScores.reduce((sum, s) => sum + (s.pikmi || 0), 0);
                const eballCount = userScores.reduce((sum, s) => sum + (s.eball || 0), 0);
                    const totalRating = pikmiCount - eballCount;

                    const card = document.createElement('div');
                    card.className = 'user-card';
                    
                    // –ê–≤–∞—Ç–∞—Ä–∫–∞: –µ—Å–ª–∏ –µ—Å—Ç—å photo_url - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ç–æ, –µ—Å–ª–∏ –Ω–µ—Ç - –ø–µ—Ä–≤—É—é –±—É–∫–≤—É
                    const avatarHTML = user.photo_url 
                        ? `<img src="${user.photo_url}" alt="${user.name}" style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 3px solid #667eea; cursor: pointer;" onclick="openProfileModal('${user.name}', '${user.photo_url || ''}')">` 
                        : `<div class="user-avatar" style="cursor: pointer;" onclick="openProfileModal('${user.name}', '')">${user.name.charAt(0).toUpperCase()}</div>`;
                    
                    card.innerHTML = `
                        <div class="user-info" style="cursor: pointer;" onclick="openProfileModal('${user.name}', '${user.photo_url || ''}')">
                            ${avatarHTML}
                            <div class="user-details">
                                <div class="user-name">${user.name}</div>
                                <div class="rating-display">
                                    <div class="rating-item">
                                        <span>‚≠ê</span>
                                        <span class="pikmi-count">${pikmiCount}</span>
                                    </div>
                                    <div class="rating-item">
                                        <span>‚ö†Ô∏è</span>
                                        <span class="eball-count">${eballCount}</span>
                                    </div>
                                    <div class="rating-item">
                                        <span>üìä</span>
                                        <span class="total-rating">${totalRating}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="event.stopPropagation(); openVoteModal('${user.name}')" class="btn-success" style="flex: 1;">–û—Ü–µ–Ω–∏—Ç—å</button>
                            <button onclick="event.stopPropagation(); openActionsModal('${user.name}')" class="btn-secondary" style="flex: 1;">–ò—Å—Ç–æ—Ä–∏—è</button>
                        </div>
                    `;
                    usersList.appendChild(card);
                });
            } catch (error) {
                console.error('Load users error:', error);
            }
        }

        // –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ü–µ–Ω–∫–∏
        function openVoteModal(userName) {
            selectedUser = userName;
            document.getElementById('voteModalTitle').textContent = `–û—Ü–µ–Ω–∏—Ç—å: ${userName}`;
            document.getElementById('voteType').value = '';
            document.getElementById('voteAmountSlider').value = '1';
            document.getElementById('sliderValueDisplay').textContent = '1';
            document.getElementById('proofText').value = '';
            document.getElementById('proofFile').value = '';
            document.getElementById('fileLabel').textContent = 'üìé –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª';
            document.getElementById('voteTypeInfo').classList.add('hidden');
            document.getElementById('voteMessage').classList.add('hidden');
            updateQuickButtons(1);
            document.getElementById('voteModal').classList.remove('hidden');
        }

        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ü–µ–Ω–∫–∏
        function closeVoteModal() {
            document.getElementById('voteModal').classList.add('hidden');
        }

        // –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∏–ø–µ –æ—Ü–µ–Ω–∫–∏
        function updateVoteTypeInfo() {
            const type = document.getElementById('voteType').value;
            const infoDiv = document.getElementById('voteTypeInfo');
            
            if (type === 'pikmi') {
                infoDiv.innerHTML = '‚≠ê <strong>Pikmi Move</strong> ‚Äî —Ö–æ—Ä–æ—à–∏–π –±–∞–ª–ª, –ø–æ–≤—ã—à–∞–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥ (+1)';
                infoDiv.style.background = '#e0ffe0';
                infoDiv.style.color = '#27ae60';
                infoDiv.classList.remove('hidden');
            } else if (type === 'eball') {
                infoDiv.innerHTML = '‚ö†Ô∏è <strong>E-Ball</strong> ‚Äî –ø–ª–æ—Ö–æ–π –±–∞–ª–ª, –ø–æ–Ω–∏–∂–∞–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥ (-1)';
                infoDiv.style.background = '#ffe0e0';
                infoDiv.style.color = '#e74c3c';
                infoDiv.classList.remove('hidden');
            } else {
                infoDiv.classList.add('hidden');
            }
        }

        // –û–±–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ —Å–ª–∞–π–¥–µ—Ä–∞
        function updateSliderValue(value) {
            document.getElementById('sliderValueDisplay').textContent = value;
            updateQuickButtons(parseInt(value));
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ —Å–ª–∞–π–¥–µ—Ä–∞
        function setSliderValue(value) {
            document.getElementById('voteAmountSlider').value = value;
            updateSliderValue(value);
        }

        // –û–±–Ω–æ–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã–±–æ—Ä–∞
        function updateQuickButtons(activeValue) {
            const buttons = document.querySelectorAll('.slider-quick-btn');
            buttons.forEach(btn => {
                if (parseInt(btn.textContent) === activeValue) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        // –û–±–Ω–æ–≤–∏—Ç—å –∏–º—è —Ñ–∞–π–ª–∞
        function updateFileName() {
            const fileInput = document.getElementById('proofFile');
            const label = document.getElementById('fileLabel');
            if (fileInput.files.length > 0) {
                label.textContent = `üìé ${fileInput.files[0].name}`;
            }
        }

        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É
        async function submitVote() {
            const voteType = document.getElementById('voteType').value;
            const amount = parseInt(document.getElementById('voteAmountSlider').value);
            const proofText = document.getElementById('proofText').value.trim();
            const fileInput = document.getElementById('proofFile');
            const messageDiv = document.getElementById('voteMessage');

            if (!voteType) {
                showMessage(messageDiv, '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ—Ü–µ–Ω–∫–∏', 'error');
                return;
            }

            if (!proofText) {
                showMessage(messageDiv, '–î–æ–±–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è', 'error');
                return;
            }

            try {
                let fileUrl = null;
                let fileName = null;
                let fileType = null;

                // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
                if (fileInput.files.length > 0) {
                    const file = fileInput.files[0];
                    fileName = `${Date.now()}_${file.name.replace(/[^a-zA-Z0-9.]/g, '_')}`;
                    fileType = file.type;

                    const { data: uploadData, error: uploadError } = await supabaseClient.storage
                        .from('proofs')
                        .upload(fileName, file);

                    if (uploadError) {
                        console.error('Upload error:', uploadError);
                        throw uploadError;
                    }

                    const { data: urlData } = supabaseClient.storage
                        .from('proofs')
                        .getPublicUrl(fileName);

                    fileUrl = urlData.publicUrl;
                }

                // –°–æ–∑–¥–∞–µ–º –û–î–ù–£ –∑–∞–ø–∏—Å—å —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –±–∞–ª–ª–æ–≤
                const record = {
                    user_name: selectedUser,
                    voter_login: currentUser.login,
                    voter_name: currentUser.name,
                    pikmi: voteType === 'pikmi' ? amount : 0,
                    eball: voteType === 'eball' ? amount : 0,
                    proof_text: proofText,
                    proof_file_url: fileUrl,
                    proof_file_name: fileName,
                    proof_file_type: fileType
                };

                const { error: insertError } = await supabaseClient
                    .from('scores')
                    .insert(record);

                if (insertError) {
                    console.error('Insert error:', insertError);
                    throw insertError;
                }

                showMessage(messageDiv, `‚úÖ –û—Ü–µ–Ω–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! (${amount} ${voteType === 'pikmi' ? 'Pikmi Move' : 'E-Ball'})`, 'success');
                
                setTimeout(() => {
                    closeVoteModal();
                    loadMyStats();
                    loadUsers();
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–π—Ç–∏–Ω–≥ –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–∞ –≤–∫–ª–∞–¥–∫–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
                    if (document.getElementById('tab-calendar').classList.contains('active')) {
                        loadPikmiRating();
                    }
                    // –û–±–Ω–æ–≤–ª—è–µ–º –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–∞ –≤–∫–ª–∞–¥–∫–∞
                    if (document.getElementById('tab-voting').classList.contains('active')) {
                        loadVotingTab();
                    }
                }, 2000);

            } catch (error) {
                console.error('Vote error:', error);
                showMessage(messageDiv, '–û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }

        // –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ–π—Å—Ç–≤–∏—è–º–∏
        async function openActionsModal(userName) {
            try {
                const { data: actions, error } = await supabaseClient
                    .from('scores')
                    .select('*')
                    .eq('user_name', userName)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                document.getElementById('actionsModalTitle').textContent = `–ò—Å—Ç–æ—Ä–∏—è: ${userName}`;
                const actionsList = document.getElementById('actionsList');
                
                if (actions.length === 0) {
                    actionsList.innerHTML = '<p style="text-align: center; color: #999;">–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ü–µ–Ω–æ–∫</p>';
                } else {
                    actionsList.innerHTML = actions.map(action => {
                        const date = new Date(action.created_at).toLocaleString('ru-RU');
                        const type = (action.pikmi || 0) > 0 ? 'pikmi' : 'eball';
                        const typeText = type === 'pikmi' ? '‚≠ê Pikmi Move' : '‚ö†Ô∏è E-Ball';
                        const typeClass = type === 'pikmi' ? 'action-type-pikmi' : 'action-type-eball';
                        
                        return `
                            <div class="action-item">
                                <div class="action-header">
                                    <span class="${typeClass}">${typeText}</span>
                                    <span style="color: #999; font-size: 12px;">${date}</span>
                                </div>
                                <div style="color: #666; font-size: 14px; margin-bottom: 5px;">–û—Ç: ${action.voter_name}</div>
                                <div class="action-text">${action.proof_text || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}</div>
                                ${action.proof_file_url ? `<img src="${action.proof_file_url}" class="action-photo" alt="–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ">` : ''}
                            </div>
                        `;
                    }).join('');
                }

                document.getElementById('actionsModal').classList.remove('hidden');
            } catch (error) {
                console.error('Load actions error:', error);
            }
        }

        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ–π—Å—Ç–≤–∏–π
        function closeActionsModal() {
            document.getElementById('actionsModal').classList.add('hidden');
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showMessage(element, message, type) {
            element.textContent = message;
            element.className = type === 'error' ? 'error' : 'success';
            element.classList.remove('hidden');
        }

        // –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å —É—á–∞—Å—Ç–Ω–∏–∫–∞
        async function openProfileModal(userName, photoUrl) {
            try {
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const { data: users, error: usersError } = await supabaseClient
                    .from('users')
                    .select('*')
                    .eq('name', userName);

                if (usersError) throw usersError;

                const user = users && users.length > 0 ? users[0] : null;
                const userPhotoUrl = user?.photo_url || photoUrl || '';

                // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –æ—Ü–µ–Ω–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const { data: allScores, error: scoresError } = await supabaseClient
                    .from('scores')
                    .select('*')
                    .eq('user_name', userName)
                    .order('created_at', { ascending: false });

                if (scoresError) throw scoresError;

                // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                const pikmiCount = allScores.reduce((sum, s) => sum + (s.pikmi || 0), 0);
                const eballCount = allScores.reduce((sum, s) => sum + (s.eball || 0), 0);
                const totalRating = pikmiCount - eballCount;

                // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã –¥–ª—è –≥–∞–ª–µ—Ä–µ–∏
                const files = allScores.filter(s => s.proof_file_url).map(s => ({
                    url: s.proof_file_url,
                    type: s.proof_file_type,
                    text: s.proof_text,
                    date: s.created_at
                }));

                // –§–æ—Ä–º–∏—Ä—É–µ–º HTML –ø—Ä–æ—Ñ–∏–ª—è
                const avatarHTML = userPhotoUrl
                    ? `<img src="${userPhotoUrl}" alt="${userName}" class="profile-avatar-large">`
                    : `<div class="profile-avatar-large-placeholder">${userName.charAt(0).toUpperCase()}</div>`;

                const galleryHTML = files.length > 0 ? `
                    <div class="profile-section">
                        <div class="profile-section-title">üì∏ –ì–∞–ª–µ—Ä–µ—è (${files.length})</div>
                        <div class="profile-gallery">
                            ${files.map((file, index) => {
                                const isVideo = file.type && file.type.startsWith('video/');
                                return `
                                    <div class="gallery-item" onclick="openGalleryModal(${index}, ${JSON.stringify(files).replace(/"/g, '&quot;')})">
                                        ${isVideo 
                                            ? `<video src="${file.url}" muted></video><div class="gallery-item-type">üé•</div>`
                                            : `<img src="${file.url}" alt="–§–æ—Ç–æ">`
                                        }
                                        <div class="gallery-item-overlay">
                                            <span>üëÅÔ∏è</span>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                ` : '';

                const profileHTML = `
                    <div class="profile-header">
                        ${avatarHTML}
                        <div class="profile-name">${userName}</div>
                    </div>

                    <div class="profile-stats">
                        <div class="profile-stat-card" style="border-color: #27ae60;">
                            <div class="profile-stat-value" style="color: #27ae60;">${pikmiCount}</div>
                            <div class="profile-stat-label">‚≠ê Pikmi Move</div>
                        </div>
                        <div class="profile-stat-card" style="border-color: #e74c3c;">
                            <div class="profile-stat-value" style="color: #e74c3c;">${eballCount}</div>
                            <div class="profile-stat-label">‚ö†Ô∏è E-Ball</div>
                        </div>
                        <div class="profile-stat-card" style="border-color: #667eea;">
                            <div class="profile-stat-value" style="color: #667eea;">${totalRating}</div>
                            <div class="profile-stat-label">üìä –û–±—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥</div>
                        </div>
                    </div>

                    ${galleryHTML}

                    <div class="profile-section">
                        <div class="profile-section-title">üìù –ò—Å—Ç–æ—Ä–∏—è –æ—Ü–µ–Ω–æ–∫ (${allScores.length})</div>
                        <div class="actions-list" style="max-height: 400px;">
                            ${allScores.length === 0 
                                ? '<p style="text-align: center; color: #999; padding: 20px;">–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ü–µ–Ω–æ–∫</p>'
                                : allScores.map(action => {
                                    const date = new Date(action.created_at).toLocaleString('ru-RU');
                                    const type = (action.pikmi || 0) > 0 ? 'pikmi' : 'eball';
                                    const typeText = type === 'pikmi' ? '‚≠ê Pikmi Move' : '‚ö†Ô∏è E-Ball';
                                    const typeClass = type === 'pikmi' ? 'action-type-pikmi' : 'action-type-eball';
                                    
                                    return `
                                        <div class="action-item">
                                            <div class="action-header">
                                                <span class="${typeClass}">${typeText}</span>
                                                <span style="color: #999; font-size: 12px;">${date}</span>
                                            </div>
                                            <div style="color: #666; font-size: 14px; margin-bottom: 5px;">–û—Ç: ${action.voter_name}</div>
                                            <div class="action-text">${action.proof_text || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}</div>
                                            ${action.proof_file_url ? `<img src="${action.proof_file_url}" class="action-photo" alt="–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ">` : ''}
                                        </div>
                                    `;
                                }).join('')
                            }
                        </div>
                    </div>

                    <div class="profile-actions">
                        <button onclick="closeProfileModal(); openVoteModal('${userName}')" class="btn-success">–û—Ü–µ–Ω–∏—Ç—å</button>
                        <button onclick="closeProfileModal(); openActionsModal('${userName}')" class="btn-secondary">–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è</button>
                    </div>
                `;

                document.getElementById('profileContent').innerHTML = profileHTML;
                document.getElementById('profileModal').classList.remove('hidden');
            } catch (error) {
                console.error('Load profile error:', error);
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è: ' + error.message);
            }
        }

        // –ó–∞–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
        function closeProfileModal() {
            document.getElementById('profileModal').classList.add('hidden');
        }

        // –í—ã—Ö–æ–¥
        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            localStorage.removeItem('userPassword');
            document.getElementById('mainPage').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
        }

        // Enter –¥–ª—è –≤—Ö–æ–¥–∞
        document.getElementById('passwordInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') login();
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –∏—Ö
        document.getElementById('voteModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('voteModal')) closeVoteModal();
        });

        document.getElementById('actionsModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('actionsModal')) closeActionsModal();
        });

        document.getElementById('profileModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('profileModal')) closeProfileModal();
        });

        document.getElementById('settingsModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('settingsModal')) closeSettings();
        });
    </script>
</body>
</html>
